<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PacientesXWSP - Estrategia M√©dica</title>
    
    <!-- Tailwind CSS (Estilos) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Estilos Personalizados -->
    <style>
        body { font-family: 'Inter', sans-serif; overflow-x: hidden; }
        
        /* Animaciones */
        .animate-fade-in { animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1); }
        .animate-float { animation: float 6s ease-in-out infinite; }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-15px); } }
        
        .secret-trigger { cursor: text; user-select: none; }
        
        /* Canvas para Confeti */
        .confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; }
    </style>

    <!-- React y ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para traducir JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-50 text-gray-900 selection:bg-blue-200 selection:text-blue-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        // Importaciones de Firebase desde CDN oficial
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, Timestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ==========================================================================================
        // üö® CONFIGURACI√ìN DE FIREBASE (YA INTEGRADA) üö®
        // ==========================================================================================
        const firebaseConfig = {
  apiKey: "AIzaSyD2uDOEk1SpPuEzBGY7X78Wnz6Ok5Pq26w",
  authDomain: "pacientesxwasap-d492e.firebaseapp.com",
  projectId: "pacientesxwasap-d492e",
  storageBucket: "pacientesxwasap-d492e.firebasestorage.app",
  messagingSenderId: "366751686496",
  appId: "1:366751686496:web:551d5086bd4f0901e9c805"
        };

        // Scripts URLs
        const SCRIPTS_VENTAS = "https://drive.google.com/drive/folders/1DSpZKMy--kY428ZJD1kmRIiTqmiHAlNn?usp=sharing";

              // Objeto de configuraci√≥n de recursos
      const RECURSOS_CONFIG = {
        GUIA_COMPORTAMIENTO: "https://drive.google.com/file/d/1DSpZKMy--kY428ZJD1kmRIiTqmiHAlNn/view?usp=sharing",
        SCRIPTS_VENTAS: SCRIPTS_VENTAS
      };

        // Estrategias personalizadas por perfil
        const PROFILE_STRATEGIES = {
            "La Cient√≠fica": "Su foco es la evidencia. Usa datos t√©cnicos, menciona estudios cl√≠nicos y certificaciones. Evita la venta emocional agresiva.",
            "La Viral": "Busca reconocimiento social. Enfatiza las tendencias, el 'glow up' visual y resultados que se vean incre√≠bles en fotos.",
            "La Urgente": "Prioriza la velocidad. Ofr√©cele disponibilidad inmediata y soluciones r√°pidas. No des rodeos ni explicaciones largas.",
            "La Calculadora": "Analiza costo-beneficio. Desglosa la inversi√≥n, ofrece paquetes y demu√©strale el valor a largo plazo de cada centavo.",
            "La Prudente": "Tiene miedo al riesgo. Tu mejor arma son los testimonios, garant√≠as de seguridad y explicar el paso a paso detallado.",
            "La Previsora": "Piensa a futuro. V√©ndele planes de mantenimiento anuales y prevenci√≥n del envejecimiento. Fidel√≠zala a largo plazo."
        };

        // --- Inicializaci√≥n Robusta de Firebase ---
        let app, auth, db;
        let firebaseInitialized = false;

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            firebaseInitialized = true;
        } catch (e) {
            console.warn("Aviso: Firebase no pudo conectarse (Modo Offline Activado).", e);
        }

        // --- Componente de Confeti (Efecto Visual) ---
        const Confetti = () => {
            const canvasRef = React.useRef(null);

            React.useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                const particles = [];
                const colors = ['#22d3ee', '#2563eb', '#ef4444', '#10b981', '#f59e0b'];

                for (let i = 0; i < 150; i++) {
                    particles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height - canvas.height,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        size: Math.random() * 8 + 4,
                        speedY: Math.random() * 3 + 2,
                        speedX: Math.random() * 2 - 1,
                        rotation: Math.random() * 360,
                        rotationSpeed: Math.random() * 10 - 5
                    });
                }

                function animate() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    particles.forEach(p => {
                        p.y += p.speedY;
                        p.x += p.speedX;
                        p.rotation += p.rotationSpeed;

                        ctx.save();
                        ctx.translate(p.x, p.y);
                        ctx.rotate((p.rotation * Math.PI) / 180);
                        ctx.fillStyle = p.color;
                        ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
                        ctx.restore();

                        if (p.y > canvas.height) {
                            p.y = -20;
                            p.x = Math.random() * canvas.width;
                        }
                    });
                    requestAnimationFrame(animate);
                }
                animate();

                const handleResize = () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                };
                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            return <canvas ref={canvasRef} className="confetti-canvas" />;
        };

        // --- Iconos SVG ---
        const IconBase = ({ d, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{d}</svg>
        );

        const Icons = {
            BookOpen: (p) => <IconBase {...p} d={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>} />,
            Download: (p) => <IconBase {...p} d={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></>} />,
            MessageCircle: (p) => <IconBase {...p} d={<path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>} />,
            User: (p) => <IconBase {...p} d={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} />,
            Mail: (p) => <IconBase {...p} d={<><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></>} />,
            CheckCircle: (p) => <IconBase {...p} d={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>} />,
            ArrowRight: (p) => <IconBase {...p} d={<><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></>} />,
            Brain: (p) => <IconBase {...p} d={<><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></>} />,
            Database: (p) => <IconBase {...p} d={<><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></>} />,
            Lock: (p) => <IconBase {...p} d={<><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>} />,
            Youtube: (p) => <IconBase {...p} d={<><path d="M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17"/><path d="m10 15 5-3-5-3z"/></>} />,
            Linkedin: (p) => <IconBase {...p} d={<><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></>} />,
            PlayCircle: (p) => <IconBase {...p} d={<><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></>} />,
            Briefcase: (p) => <IconBase {...p} d={<><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></>} />,
            AlertCircle: (p) => <IconBase {...p} d={<><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></>} />
        };

        const LogoPXW = () => (
            <div className="flex items-center gap-4"> 
                <div className="relative w-16 h-16 flex-shrink-0 transition-transform hover:scale-105 duration-300">
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-lg" fill="none">
                    <defs>
                        <linearGradient id="logoGrad" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stopColor="#22d3ee" />
                            <stop offset="100%" stopColor="#2563eb" />
                        </linearGradient>
                    </defs>
                    <circle cx="50" cy="50" r="50" fill="url(#logoGrad)" />
                    <path d="M18 28 H30 L35 18 L40 38 L45 28 H52" stroke="white" strokeWidth="3.5" strokeLinecap="round" strokeLinejoin="round" />
                    <path d="M58 20 H76 C79 20 81 22 81 25 V 35 C81 38 79 40 76 40 H62 L58 44 V 25 C58 22 60 20 58 20 Z" stroke="white" strokeWidth="3.5" strokeLinecap="round" strokeLinejoin="round" fill="none"/>
                    <text x="50" y="62" fontSize="30" fontFamily="Arial, sans-serif" fontWeight="900" fill="white" textAnchor="middle" letterSpacing="-1">PXW</text>
                    <path d="M25 80 H40 L45 70 L50 90 L55 80 H75" stroke="white" strokeWidth="3.5" strokeLinecap="round" strokeLinejoin="round" />
                </svg>
                </div>
                <div className="flex flex-col justify-center">
                    <span className="font-black text-3xl leading-none text-gray-800 tracking-tighter">PXW</span>
                    <span className="text-[11px] font-bold text-blue-600 tracking-widest uppercase mt-1">PacientesXWSP</span>
                </div>
            </div>
        );

        // --- VISTAS ---

        const IntroView = ({ onStart }) => (
            <div className="flex flex-col items-center justify-center min-h-[60vh] text-center px-4 space-y-8 animate-fade-in relative overflow-hidden">
                <div className="absolute top-0 left-0 w-64 h-64 bg-cyan-100 rounded-full mix-blend-multiply filter blur-3xl opacity-30 -translate-x-1/2 -translate-y-1/2"></div>
                <div className="absolute bottom-0 right-0 w-64 h-64 bg-blue-100 rounded-full mix-blend-multiply filter blur-3xl opacity-30 translate-x-1/2 translate-y-1/2"></div>
                
                <div className="bg-white p-6 rounded-3xl shadow-xl border border-blue-50 z-10 animate-float">
                    <LogoPXW />
                </div>

                <div className="space-y-4 max-w-3xl z-10">
                    <h1 className="text-4xl md:text-6xl font-extrabold text-gray-900 tracking-tight leading-tight">
                        No es el precio... <br/>
                        <span className="bg-clip-text text-transparent bg-gradient-to-r from-cyan-500 to-blue-700">Es el mensaje correcto.</span>
                    </h1>
                    <p className="text-lg md:text-xl text-gray-600 leading-relaxed max-w-2xl mx-auto">
                        Domina los 6 perfiles y los 5 niveles de conciencia. Descarga mis guiones probados y la gu√≠a de comportamiento del consumidor de medicina est√©tica.
                    </p>
                    <div className="flex flex-wrap justify-center gap-4 mt-4">
                        <a href="https://www.youtube.com/@pacienteswsp" target="_blank" rel="noreferrer" className="inline-flex items-center gap-2 px-6 py-3 bg-red-600 text-white font-bold rounded-full hover:bg-red-700 transition-all shadow-md hover:shadow-lg hover:-translate-y-1">
                            <Icons.Youtube className="w-5 h-5" /> YouTube
                        </a>
                        <a href="https://www.linkedin.com/in/fabian-silva-6b936232b/" target="_blank" rel="noreferrer" className="inline-flex items-center gap-2 px-6 py-3 bg-[#0077b5] text-white font-bold rounded-full hover:bg-[#006396] transition-all shadow-md hover:shadow-lg hover:-translate-y-1">
                            <Icons.Linkedin className="w-5 h-5" /> LinkedIn
                        </a>
                    </div>
                </div>
                
                <div className="bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-xl border-t-4 border-blue-500 max-w-lg w-full z-10 mt-8">
                    <h3 className="font-bold text-gray-800 mb-6 text-xl flex items-center justify-center gap-2">
                        <Icons.Download className="w-6 h-6 text-blue-600" /> Accede a los Recursos Gratuitos
                    </h3>
                    <ul className="text-left space-y-4 text-gray-700 mb-8">
                        <li className="flex items-start gap-3 bg-blue-50 p-3 rounded-lg hover:bg-blue-100 transition-colors cursor-default">
                            <Icons.CheckCircle className="w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0" />
                            <span className="text-sm font-medium">Gu√≠a: Comportamiento del Consumidor (6 Perfiles)</span>
                        </li>
                        <li className="flex items-start gap-3 bg-blue-50 p-3 rounded-lg hover:bg-blue-100 transition-colors cursor-default">
                            <Icons.CheckCircle className="w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0" />
                            <span className="text-sm font-medium">Scripts de Venta Universal para WhatsApp</span>
                        </li>
                    </ul>
                    <button onClick={onStart} className="w-full bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1 flex items-center justify-center gap-2 text-lg">
                        Comenzar Diagn√≥stico de Cl√≠nica <Icons.ArrowRight className="w-6 h-6" />
                    </button>
                </div>
            </div>
        );

        const QuizView = ({ currentQuestion, handleAnswer, questions }) => (
            <div className="max-w-xl mx-auto w-full px-4 animate-fade-in py-10">
                <div className="mb-8">
                    <div className="flex justify-between text-sm text-blue-600 font-semibold mb-2">
                        <span>Pregunta {currentQuestion + 1} de {questions.length}</span>
                        <span>Diagn√≥stico de Ventas</span>
                    </div>
                    <div className="w-full bg-blue-100 rounded-full h-3">
                        <div className="bg-gradient-to-r from-cyan-500 to-blue-600 h-3 rounded-full transition-all duration-500 shadow-sm" style={{ width: `${((currentQuestion + 1) / questions.length) * 100}%` }}></div>
                    </div>
                </div>

                <h2 className="text-2xl font-bold text-gray-800 mb-6 leading-snug">{questions[currentQuestion].question}</h2>
                <div className="space-y-4">
                    {questions[currentQuestion].options.map((opt, idx) => (
                        <button key={idx} onClick={() => handleAnswer(opt.profile)} className="w-full text-left p-6 rounded-2xl border-2 border-gray-100 hover:border-blue-500 hover:bg-blue-50 hover:shadow-md transition-all group duration-200 transform hover:-translate-y-1">
                            <span className="font-medium text-gray-700 group-hover:text-blue-800 text-lg flex items-center gap-3">
                                <span className="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-blue-500 flex items-center justify-center flex-shrink-0">
                                    <div className="w-3 h-3 rounded-full bg-blue-500 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                </span>
                                {opt.text}
                            </span>
                        </button>
                    ))}
                </div>
            </div>
        );

        const FormView = ({ formData, setFormData, handleSubmit, loading, emailError, setEmailError, quizProfile }) => (
            <div className="max-w-md mx-auto w-full px-4 py-10 animate-fade-in">
                <div className="text-center mb-8">
                    <div className="inline-block p-4 bg-blue-100 rounded-full mb-4 shadow-lg transform rotate-3">
                        <Icons.Brain className="w-10 h-10 text-blue-600" />
                    </div>
                    <h2 className="text-2xl font-bold text-gray-900">¬°Diagn√≥stico Completado!</h2>
                    <p className="text-gray-600 mt-2">
                        Tu mayor √°rea de oportunidad est√° en dominar al perfil: <br/>
                        <span className="font-extrabold text-3xl text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-500 block mt-2 animate-pulse-slow">{quizProfile}</span>
                    </p>
                    
                    {/* ESTRATEGIA VISIBLE */}
                    <div className="mt-6 bg-blue-50 p-5 rounded-xl border border-blue-200 text-left shadow-sm relative">
                        <div className="absolute -top-3 left-6 bg-blue-600 text-white text-xs font-bold px-3 py-1 rounded-full">ESTRATEGIA CLAVE</div>
                        <p className="text-sm text-gray-700 leading-relaxed mt-2">
                            {PROFILE_STRATEGIES[quizProfile]}
                        </p>
                    </div>

                    <p className="text-sm text-gray-500 mt-6">
                        Completa tus datos para recibir los <strong>Scripts Exactos</strong>.
                    </p>
                </div>
                <form onSubmit={handleSubmit} className="space-y-5 bg-white p-8 rounded-2xl shadow-2xl border border-gray-100 relative overflow-hidden">
                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-400 to-blue-600"></div>
                    <div>
                        <label className="block text-sm font-bold text-gray-700 mb-1">Nombre Completo</label>
                        <div className="relative">
                            <Icons.User className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-blue-400" />
                            <input required type="text" value={formData.nombre} onChange={e => setFormData({...formData, nombre: e.target.value})} className="pl-10 w-full py-3 pr-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all text-gray-800" placeholder="Ej. Dra. Mar√≠a P√©rez" />
                        </div>
                    </div>
                    <div>
                        <label className="block text-sm font-bold text-gray-700 mb-1">Correo Electr√≥nico</label>
                        <div className="relative">
                            <Icons.Mail className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-blue-400" />
                            <input required type="email" value={formData.email} onChange={e => { setFormData({...formData, email: e.target.value}); setEmailError(''); }} className={`pl-10 w-full py-3 pr-3 border rounded-lg focus:ring-2 outline-none transition-all text-gray-800 ${emailError ? 'border-red-500 focus:ring-red-200' : 'border-gray-300 focus:ring-blue-500'}`} placeholder="maria@clinica.com" />
                        </div>
                        {emailError && <p className="text-xs text-red-500 mt-1 flex items-center gap-1 animate-pulse"><Icons.AlertCircle className="w-3 h-3" /> {emailError}</p>}
                    </div>
                    <div>
                        <label className="block text-sm font-bold text-gray-700 mb-1">Tu Rol Profesional</label>
                        <div className="relative">
                            <Icons.Briefcase className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-blue-400" />
                            <select required value={formData.rol} onChange={e => setFormData({...formData, rol: e.target.value})} className="pl-10 w-full py-3 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all text-gray-800 bg-white appearance-none cursor-pointer">
                                <option value="" disabled>Selecciona una opci√≥n</option>
                                <option value="Gerente de Cl√≠nica">Gerente / Due√±o de Cl√≠nica</option>
                                <option value="M√©dico / Doctor">M√©dico / Doctor</option>
                                <option value="Marketero">Marketero / Agencia</option>
                                <option value="Otro">Otro</option>
                            </select>
                            <div className="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400">‚ñº</div>
                        </div>
                    </div>
                    <button type="submit" disabled={loading} className="w-full bg-gray-900 text-white font-bold py-4 rounded-xl hover:bg-gray-800 transition-all transform hover:scale-[1.02] flex justify-center items-center gap-3 shadow-lg active:scale-95">
                        {loading ? 'Guardando...' : 'DESBLOQUEAR ESTRATEGIA'}
                        {!loading && <Icons.Download className="w-5 h-5" />}
                    </button>
                </form>
            </div>
        );

        const SuccessView = ({ nombre }) => (
            <div className="max-w-3xl mx-auto w-full px-4 py-10 animate-fade-in text-center relative">
                {/* Confeti Effect */}
                <Confetti />
                
                <div className="inline-block p-5 bg-green-100 rounded-full mb-6 shadow-sm animate-bounce">
                    <Icons.CheckCircle className="w-16 h-16 text-green-600" />
                </div>
                <h2 className="text-4xl font-extrabold text-gray-900 mb-4">¬°Registro Exitoso!</h2>
                <p className="text-gray-600 mb-10 max-w-xl mx-auto text-lg">Bienvenido a la comunidad <strong>PXW</strong>, {nombre}. Aqu√≠ tienes tus herramientas para dominar a ese paciente.</p>
                <div className="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto relative z-10">
                    <div className="bg-white p-8 rounded-2xl shadow-lg border border-blue-100 hover:border-blue-300 transition-all group relative overflow-hidden flex flex-col hover:-translate-y-2 duration-300">
                        <div className="absolute top-0 right-0 bg-blue-600 text-white text-xs font-bold px-3 py-1 rounded-bl-lg">GU√çA PDF</div>
                        <div className="bg-blue-50 p-4 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                            <Icons.BookOpen className="w-8 h-8 text-blue-600" />
                        </div>
                        <h3 className="font-bold text-gray-900 text-xl mb-2">Comportamiento del Consumidor</h3>
                        <p className="text-sm text-gray-500 mb-6 flex-grow">An√°lisis profundo de los 6 perfiles psicol√≥gicos.</p>
                        <a href={RECURSOS_CONFIG.GUIA_COMPORTAMIENTO} target="_blank" rel="noopener noreferrer" className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 mt-auto shadow-md">
                            <Icons.Download className="w-4 h-4" /> Descargar Gu√≠a
                        </a>
                    </div>
                    <div className="bg-white p-8 rounded-2xl shadow-lg border border-cyan-100 hover:border-cyan-300 transition-all group relative overflow-hidden flex flex-col hover:-translate-y-2 duration-300">
                        <div className="absolute top-0 right-0 bg-cyan-600 text-white text-xs font-bold px-3 py-1 rounded-bl-lg">SCRIPTS PDF</div>
                        <div className="bg-cyan-50 p-4 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                            <Icons.MessageCircle className="w-8 h-8 text-cyan-600" />
                        </div>
                        <h3 className="font-bold text-gray-900 text-xl mb-2">Guiones de Venta WhatsApp</h3>
                        <p className="text-sm text-gray-500 mb-6 flex-grow">Copys exactos para copiar y pegar.</p>
                        <a href={RECURSOS_CONFIG.SCRIPTS_VENTAS} target="_blank" rel="noopener noreferrer" className="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 mt-auto shadow-md">
                            <Icons.Download className="w-4 h-4" /> Descargar Scripts
                        </a>
                    </div>
                </div>
                <div className="mt-12 bg-gradient-to-r from-gray-900 to-gray-800 p-8 rounded-2xl text-white shadow-xl max-w-2xl mx-auto relative z-10 transform hover:scale-[1.01] transition-transform">
                    <h4 className="font-bold text-2xl mb-2 flex items-center justify-center gap-2">
                        <Icons.PlayCircle className="w-6 h-6 text-red-500" /> No te pierdas la serie completa
                    </h4>
                    <p className="text-gray-300 mb-6">Aprende a aplicar estos conceptos en video en mi canal de YouTube.</p>
                    <div className="flex flex-wrap justify-center gap-4 mt-6">
                        <a href="https://www.youtube.com/@pacienteswsp" target="_blank" rel="noreferrer" className="inline-block bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-full transition-all hover:shadow-lg hover:scale-105 shadow-red-900/50 shadow-lg">
                            Ir a PacientesXWSP en YouTube
                        </a>
                        <a href="https://www.linkedin.com/in/fabian-silva-6b936232b/" target="_blank" rel="noreferrer" className="inline-block bg-[#0077b5] hover:bg-[#006396] text-white font-bold py-3 px-8 rounded-full transition-all hover:shadow-lg hover:scale-105 shadow-blue-900/50 shadow-lg">
                            Conectar en LinkedIn
                        </a>
                    </div>
                </div>
            </div>
        );

        const AdminView = ({ leads, onBack }) => (
            <div className="max-w-4xl mx-auto w-full px-4 py-10 animate-fade-in bg-white/95 min-h-screen">
                <div className="flex justify-between items-center mb-6">
                    <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                        <Icons.Database className="w-6 h-6 text-red-600" /> Base de Datos Secreta (Admin)
                    </h2>
                    <button onClick={onBack} className="text-sm text-gray-500 hover:text-red-600 underline">Cerrar Sesi√≥n</button>
                </div>
                <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div className="overflow-x-auto">
                        <table className="w-full text-left text-sm">
                            <thead className="bg-gray-100 border-b border-gray-200">
                                <tr>
                                    <th className="p-4 font-semibold text-gray-700">Fecha</th>
                                    <th className="p-4 font-semibold text-gray-700">Nombre</th>
                                    <th className="p-4 font-semibold text-gray-700">Email</th>
                                    <th className="p-4 font-semibold text-gray-700">Rol</th>
                                    <th className="p-4 font-semibold text-gray-700">Resultado</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {leads.length === 0 ? <tr><td colSpan={5} className="p-8 text-center text-gray-500">No hay registros a√∫n.</td></tr> : leads.map((lead, i) => (
                                    <tr key={lead.id || i} className="hover:bg-gray-50">
                                        <td className="p-4 text-gray-500">{lead.fecha ? new Date(lead.fecha.seconds * 1000).toLocaleDateString() : 'Ahora'}</td>
                                        <td className="p-4 font-medium">{lead.nombre}</td>
                                        <td className="p-4 text-gray-600">{lead.email}</td>
                                        <td className="p-4"><span className="bg-gray-200 px-2 py-1 rounded text-xs">{lead.rol}</span></td>
                                        <td className="p-4"><span className="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-bold">{lead.quizResult}</span></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        );

        function App() {
            // Estados: 'intro' -> 'quiz' -> 'form' -> 'success'
            const [step, setStep] = React.useState('intro');
            const [currentQuestion, setCurrentQuestion] = React.useState(0);
            const [quizProfile, setQuizProfile] = React.useState('');
            const [user, setUser] = React.useState(null);
            const [formData, setFormData] = React.useState({ nombre: '', email: '', rol: '' });
            const [loading, setLoading] = React.useState(false);
            const [emailError, setEmailError] = React.useState('');
            const [secretClicks, setSecretClicks] = React.useState(0);
            const [leads, setLeads] = React.useState([]);
            
            // Estado para manejar el modo offline
            const [isOfflineMode, setIsOfflineMode] = React.useState(false);

            const questions = [
                { id: 1, question: "¬øCu√°l es la objeci√≥n m√°s frustrante que recibes por WhatsApp?", options: [{ text: "'Es muy caro' o 'En otro lado me cobran menos'.", profile: "La Calculadora" }, { text: "'Lo voy a pensar' o 'Me da miedo quedar mal'.", profile: "La Prudente" }, { text: "Me piden mil detalles t√©cnicos y al final no agendan.", profile: "La Cient√≠fica" }, { text: "Quieren citas inmediatas y se molestan si no hay lugar.", profile: "La Urgente" }] },
                { id: 2, question: "¬øQu√© sientes que le falta a tu estrategia actual de marketing?", options: [{ text: "Atraigo muchos curiosos, pero pocos pacientes de calidad.", profile: "La Viral" }, { text: "Mis pacientes no regresan, me falta fidelizaci√≥n.", profile: "La Previsora" }, { text: "Me cuesta transmitir el valor de mi experiencia/t√≠tulos.", profile: "La Cient√≠fica" }, { text: "No logro cerrar ventas r√°pidas, los chats se hacen eternos.", profile: "La Urgente" }] },
                // --- NUEVA PREGUNTA A√ëADIDA ---
                { id: 3, question: "¬øQu√© tipo de contenido te resulta m√°s natural publicar en redes?", options: [{ text: "Antes y despu√©s impactantes y visuales.", profile: "La Viral" }, { text: "Explicaciones m√©dicas detalladas y educativas.", profile: "La Cient√≠fica" }, { text: "Promociones, paquetes y opciones de pago.", profile: "La Calculadora" }, { text: "Tips de cuidado a largo plazo y prevenci√≥n.", profile: "La Previsora" }] }
            ];

            React.useEffect(() => {
                const initAuth = async () => {
                    try {
                        if (firebaseInitialized) {
                            await signInAnonymously(auth);
                        } else {
                            throw new Error("Firebase no inicializado");
                        }
                    } catch (e) {
                        console.warn("Modo Local Activado: No se pudo conectar a BD.", e);
                        setIsOfflineMode(true);
                        setUser({ uid: "local-user-fallback", isAnonymous: true });
                    }
                };
                initAuth();
                
                if (firebaseInitialized && auth) {
                    const unsubscribe = onAuthStateChanged(auth, (u) => {
                        if (u) setUser(u);
                        else setUser(null);
                    });
                    return () => unsubscribe();
                }
            }, []);

            React.useEffect(() => {
                if (isOfflineMode || !user || !db) return;
                try {
                    const q = query(collection(db, 'leads'));
                    const unsub = onSnapshot(q, (snap) => {
                        const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        data.sort((a,b) => (b.fecha?.seconds || 0) - (a.fecha?.seconds || 0));
                        setLeads(data);
                    }, (error) => {
                        setIsOfflineMode(true);
                    });
                    return () => unsub();
                } catch(e) { 
                    setIsOfflineMode(true);
                }
            }, [user, step, isOfflineMode]);

            const handleSecretClick = () => {
                const newCount = secretClicks + 1;
                setSecretClicks(newCount);
                if (newCount >= 5) { setStep('admin'); setSecretClicks(0); }
            };

            const handleAnswer = (profile) => {
                if (currentQuestion < questions.length - 1) { 
                    setQuizProfile(profile); 
                    setCurrentQuestion(currentQuestion + 1); 
                } else { 
                    setQuizProfile(profile); 
                    // CAMBIO: Paso directo al formulario
                    setStep('form'); 
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.email)) { setEmailError('Email inv√°lido.'); return; }
                if (!formData.rol) { alert("Selecciona tu rol."); return; }
                setLoading(true);
                
        // === LOGS DE DEBUG ===
        console.log('üìò Iniciando guardado...');
        console.log('isOfflineMode:', isOfflineMode);
        console.log('firebaseInitialized:', firebaseInitialized);
        console.log('db:', db);
        console.log('auth:', auth);
        console.log('user:', user);
        console.log('formData:', formData);
        console.log('quizProfile:', quizProfile);
                
                try {
                    if (!isOfflineMode && firebaseInitialized) {
                        const newLead = { ...formData, quizResult: quizProfile, fecha: Timestamp.now() };
                        await addDoc(collection(db, 'leads'), newLead);
                    } else {
                        await new Promise(r => setTimeout(r, 800)); // Simular espera breve
                    }
                    setStep('success');
                } catch (error) {
                            console.error('‚ùå ERROR AL GUARDAR EN FIREBASE:', error);
        console.error('Detalles del error:', error.message);
        console.error('C√≥digo:', error.code);
        alert('ERROR: ' + error.message);
        // setStep('success');  // DESACTIVADO PARA DEBUG
                } finally { 
                    setLoading(false); 
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-gray-900">
                    {step !== 'admin' && (
                        <nav className="bg-white/90 backdrop-blur-md border-b border-gray-200 sticky top-0 z-50 shadow-sm">
                            <div className="max-w-6xl mx-auto px-4 h-20 flex items-center justify-between">
                                <div onClick={() => setStep('intro')} className="cursor-pointer"><LogoPXW /></div>
                            </div>
                        </nav>
                    )}
                    <main className="flex flex-col items-center pt-8 pb-20">
                        {step === 'intro' && <IntroView onStart={() => setStep('quiz')} />}
                        {step === 'quiz' && <QuizView currentQuestion={currentQuestion} handleAnswer={handleAnswer} questions={questions} />}
                        {step === 'form' && <FormView formData={formData} setFormData={setFormData} handleSubmit={handleSubmit} loading={loading} emailError={emailError} setEmailError={setEmailError} quizProfile={quizProfile} />}
                        {step === 'success' && <SuccessView nombre={formData.nombre} />}
                        {step === 'admin' && <AdminView leads={leads} onBack={() => setStep('intro')} />}
                    </main>
                    {step !== 'admin' && (
                        <footer className="w-full bg-white border-t border-gray-200 py-8 text-center">
                            <div className="flex flex-col items-center gap-4">
                                <div className="flex gap-4">
                                    <a href="https://www.youtube.com/@pacienteswsp" target="_blank" rel="noreferrer" className="text-gray-400 hover:text-red-600 transition-colors"><Icons.Youtube className="w-6 h-6" /></a>
                                    <a href="https://www.linkedin.com/in/fabian-silva-6b936232b/" target="_blank" rel="noreferrer" className="text-gray-400 hover:text-blue-700 transition-colors"><Icons.Linkedin className="w-6 h-6" /></a>
                                </div>
                                <p onClick={handleSecretClick} className="text-sm text-gray-500 secret-trigger select-none hover:text-gray-700 transition-colors" title="Acceso Admin">¬© 2024 PacientesXWSP. Todos los derechos reservados.</p>
                            </div>
                        </footer>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
